<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Мини-приложение</title>
</head>
<body>
<h1 id="greeting">Привет!</h1>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
const tg = window.Telegram.WebApp;

async function init() {
  try {
    const res = await fetch("https://broken-meadow-47c5.ivlievd156.workers.dev/validate", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({ initData: tg.initData })
    });
    const data = await res.json();
    if(data.ok) {
      const name = data.user.first_name || "Пользователь";
      document.getElementById("greeting").textContent = `Привет, ${name}!`;
    } else {
      document.getElementById("greeting").textContent = "Ошибка доступа";
    }
  } catch(e) {
    document.getElementById("greeting").textContent = "Ошибка связи с сервером";
  }
}

init();
</script>
</body>
</html>
