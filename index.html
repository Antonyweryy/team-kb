<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π ‚Äî –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <main id="app">
    <h1>üìö –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –∫–æ–º–∞–Ω–¥—ã</h1>
    <p class="lead">–ó–¥–µ—Å—å —Å–æ–±—Ä–∞–Ω—ã —á–µ–∫–ª–∏—Å—Ç—ã, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ —É—á–µ–±–Ω—ã–µ –º–æ–¥—É–ª–∏ ‚Äî –≤—Å—ë –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ. –û—Ç–∫—Ä—ã–≤–∞–π –∏–∑ –Ω–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram, —á—Ç–æ–±—ã —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ç—è–Ω—É–ª–∞ —Ç–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å –∏ –ø—Ä–æ–≤–µ—Ä–∏–ª–∞ –¥–æ—Å—Ç—É–ø.</p>

    <section id="status">
      <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞...</p>
    </section>

    <nav id="modules" style="display:none;">
      <ul>
        <li><a id="m1" href="module1.html">–ú–æ–¥—É–ª—å 1 ‚Äî –í–≤–µ–¥–µ–Ω–∏–µ –∏ –ø—Ä–∞–≤–∏–ª–∞</a></li>
        <li><a id="m2" href="module2.html" class="locked">–ú–æ–¥—É–ª—å 2 ‚Äî –û—Å–Ω–æ–≤—ã –ø—Ä–æ—Ü–µ—Å—Å–∞</a></li>
        <li><a id="m3" href="module3.html" class="locked">–ú–æ–¥—É–ª—å 3 ‚Äî –ü—Ä–∞–∫—Ç–∏–∫–∞</a></li>
        <li><a id="m4" href="module4.html" class="locked">–ú–æ–¥—É–ª—å 4 ‚Äî –¢–µ—Å—Ç—ã –∏ –∫–µ–π—Å—ã</a></li>
      </ul>
    </nav>

    <p class="note">–ï—Å–ª–∏ —Ç—ã –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–ª —ç—Ç–æ —á–µ—Ä–µ–∑ –±–æ—Ç ‚Äî –æ—Ç–∫—Ä–æ–π –±–æ—Ç–∞ –∏ –Ω–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É ¬´–û—Ç–∫—Ä—ã—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π¬ª.</p>
  </main>

  <script>
    const API = 'https://YOUR_WORKER_SUBDOMAIN.workers.dev/validate'; // <- –ø–æ–º–µ–Ω—è–µ—à—å –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è worker
    const tg = window.Telegram?.WebApp;
    const statusEl = document.getElementById('status');
    const modulesEl = document.getElementById('modules');

    async function validate() {
      if (!tg || !tg.initData) {
        statusEl.innerHTML = '<b>–û—Ç–∫—Ä—ã–≤–∞–π –º–∏–Ω–∏-–∞–ø–ø —á–µ—Ä–µ–∑ –±–æ—Ç. –°–µ–π—á–∞—Å –Ω–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.</b>';
        return;
      }
      try {
        const r = await fetch(API, {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({initData: tg.initData})
        });
        const j = await r.json();
        if (j.ok && j.allowed) {
          statusEl.innerHTML = `<b>–î–æ—Å—Ç—É–ø –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω: ${j.user.first_name || 'User'} (${j.user.id})</b>`;
          localStorage.setItem('tg_kb_session', JSON.stringify(j)); // –∫–µ—à–∏–º
          // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏
          modulesEl.style.display = 'block';
          // —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –Ω—É–∂–Ω—ã–µ
          (j.allowedModules || []).forEach(m => {
            const a = document.getElementById('m'+m);
            if (a) a.classList.remove('locked');
          });
        } else {
          statusEl.innerHTML = '<b>–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω. –°–≤—è–∂–∏—Å—å —Å –∞–¥–º–∏–Ω–æ–º.</b>';
        }
      } catch(e){
        statusEl.innerHTML = '<b>–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º. –ü—Ä–æ–≤–µ—Ä—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é.</b>';
        console.error(e);
      }
    }

    validate();
  </script>
</body>
</html>
